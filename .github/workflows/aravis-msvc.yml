
name: Test Opencv
on: push

jobs:
  test:
    runs-on: ubuntu-latest
    name: Test the action
    steps:
    - uses: actions/checkout@v3
    - name: add key
      run: |
        sudo apt-get update && sudo apt-get -y install build-essential cmake libgtk-3-dev git ninja-build
        mkdir install
        
    - name: build
      run: |
        # Download and unpack sources
        git clone https://github.com/opencv/opencv.git -b 4.5.5
        cd opencv && git clone https://github.com/opencv/opencv_contrib -b 4.5.5
        mkdir -p build && mkdir -p install && cd build
        ls  "../opencv_contrib/modules"
        # Build
        # cmake -DCMAKE_BUILD_TYPE=Release -DBUILD_opencv_java=OFF -DBUILD_opencv_python=OFF -DCMAKE_INSTALL_PREFIX=../install \
        #  -D OPENCV_EXTRA_MODULES_PATH=../opencv_contrib/modules ../
        cmake -DCMAKE_BUILD_TYPE=Release -DBUILD_opencv_java=OFF -DBUILD_opencv_python=OFF -DCMAKE_INSTALL_PREFIX=../install  ../
        make -j4
        make install
                
    - uses: actions/upload-artifact@v4
      with:
       name: opencv-4.5.5-x86-64-linux.tar.gz
       path: opencv/install/* 
        
